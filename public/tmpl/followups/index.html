
<!DOCTYPE html>

<html>
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE-edge">
		<title>Resounding followups dashboard</title>
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Open+Sans">
		<link rel="stylesheet" href="css/bootstrap.css">
		<link rel="stylesheet" href="css/bootstrap-modal.css">
		<link rel="stylesheet" href="css/font-awesome.css">
		<link rel="stylesheet" href="css/followup.css">
	</head>
	<body>
		<nav class="navbar navbar-default navbar-fixed-top">
			<div class="navbar-header">
				<button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
				<a class="navbar-brand" href="/"><i class="icon-beaker"></i> Followups</a>
			</div>		
			<div class="collapse navbar-collapse">
				<form class="navbar-form" action="search" method="GET">
					<div class="input-group col-xs-9 col-sm-4 col-lg-3">
						<input type="search" name="q" class="form-control" placeholder="Search" />
						<input type="hidden" name="tag" />
						<span class="input-group-btn">									
							<button type="submit" class="btn btn-default">
								<i class="icon-search"></i>
							</button>
							<div class="btn-group">
								<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
									<i class="icon-tags"></i>
									<span class="caret"></span>
								</button>
								<ul class="dropdown-menu" role="menu">
									<li><a href="#">&gt; $5M</a></li>
									<li><a href="#">Fall Roadshow</a></li>
									<li><a href="#">Golf</a></li>
									<li class="divider"></li>
									<li><a href="#">Show All</a></li>
								</ul>
							</div>
						</span>
					</div>					
					<a href="/people/new" class="btn btn-default navbar-link">
						<i class="icon-plus"></i>
						<span>Add client</span>						
					</a>
					
				</form>
			</div>
		</nav>

		<div class="col-sm-6">
			<% followups.forEach(function(row) { %>
			<% var overdueClass = row.overdue ? 'overdue' : ''; %>
			<% var iconClass = 'icon-calendar'; %>
			<% switch((row.nextContact.type || '').toLowerCase()) {
				case 'call': iconClass = 'icon-phone'; break;
				case 'meeting': iconClass = 'icon-group'; break;
				case 'email': iconClass = 'icon-envelope'; break;
			} %>
			<div class="appointment <%= overdueClass %>">
				<div class="col-xs-8">
					<h3><%- row.firstName %> <%- row.lastName %></h3>

					<address>
						<strong><%- row.organization %></strong><br />
						<% if(row.address) { %>
							<% if(row.address.street) { %>
								<%- row.address.street %>
								<br />
							<% } %>
							<%- row.address.city %>
							<% if(row.address.city && row.address.province) { print(', '); } %>
							<%- row.address.province %>
							<% if(row.address.city && row.address.province) { %>
								<br />
							<% } %>
						<% } %>
						<% if(row.email) { %>
							<abbr title="Email">E:</abbr>
							<a href="mailto:<%= row.email %>">
								<%= row.email %>
							</a>
							<br />
						<% } %>
						<% if(row.phones) { %>
							<% row.phones.forEach(function(phone) { %>
								<abbr title="<%= phone.type%>"><%= phone.abbreviation %>:</abbr>
								<a href="tel:<%= phone.number %>"><%= phone.number %></a>
								<br />
							<% }) %>						
						<% } %>
					</address>
				</div>
				<div class="col-xs-4" style="text-align: center">
					<div class="icon-stack" style="margin-top: 20px; margin-bottom: 10px;">
						<% if(row.nextContact.confirmed) { %>
							<i class="icon-calendar-empty icon-stack-base"></i>
							<i class="icon-border <%= iconClass %>"></i>
						<% } else { %>
							<i class="icon-stack-base <%= iconClass %>"></i>
						<% } %>
					</div>
					<% if(row.nextContact.confirmed) { %>
					<h4><%= row.nextContact.timeString %></h4>
					<% } else { %>
					<h4><%- row.nextContact.reason %></h4>
					<% } %>
					<% if(row.overdue) { %>
					<h4><%= row.nextContact.dateString %></h4>
					<% } %>
					<!-- <div class="map" id="burlington-financial-map"></div>-->
				</div>
			</div>
			<% }); %>			
		</div>

		<script src="js/jquery-1.10.2.js"></script>
		<script src="js/bootstrap.js"></script>
		<script src="js/bootstrap-modal.js"></script>
		<script src="js/bootstrap-modalmanager.js"></script>
		<script src="//maps.googleapis.com/maps/api/js?key=AIzaSyCmVsKj8xNC1dLEWI0thHQlHB3rr1iHHIY&sensor=true"></script>
		<script type="text/javascript">
		function initialize() {
			var mapOptions = {
				center: new google.maps.LatLng(43.3561686, -79.7742005),
					zoom: 15,
					mapTypeId: google.maps.MapTypeId.ROADMAP,
					streetViewControl: false,
					mapTypeControl: false
			};
			var map = new google.maps.Map(document.getElementById('burlington-financial-map'), mapOptions);
		}
		
		google.maps.event.addDomListener(window, 'load', initialize);

		$(function() {
			$(document).on('click', 'form[action=search] ul.dropdown-menu a', function(e) {
				debugger;
				var $form = $('form[action=search]');
				$form.find('input[type=hidden]').val(e.currentTarget.innerText);
				$form.submit();
			});
		});
		</script>
	</body>
</html>